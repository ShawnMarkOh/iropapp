<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Weather IROP Prediction Dashboard</title>
  <link rel="icon" type="image/png" href="/static/iropfavicon.png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/static/stylesheet.css" rel="stylesheet">
</head>
<body>
  <div id="top-bar">Weather IROP Prediction Dashboard</div>
  <div id="groundstop-banner"></div>
  <div id="briefing-summary">Loading crew briefing...</div>
  <div id="dashboard" class="container-fluid"></div>

  <!-- Load Previous Weather Button -->
  <div style="text-align:center; margin:40px 0 10px 0;">
    <button id="weatherHistoryBtn" class="btn btn-outline-primary" style="font-size:1.1rem;">
      Load Previous Weather
    </button>
  </div>

  <!-- Date Picker Modal -->
  <div class="modal fade" id="dateModal" tabindex="-1" aria-labelledby="dateModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header py-2">
          <h5 class="modal-title" id="dateModalLabel">Select Date</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="dateModalBody">
          <input type="date" id="datePicker" class="form-control" />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="pickDateBtn">Load Weather</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Hour Detail Modal (existing) -->
  <div class="modal fade" id="hourModal" tabindex="-1" aria-labelledby="hourModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header py-2">
          <h5 class="modal-title" id="hourModalLabel"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="hourModalBody"></div>
      </div>
    </div>
  </div>

  <div class="footer">
    Data: <a href="https://www.weather.gov/documentation/services-web-api" target="_blank" style="color:#2a58a5;">NWS API</a> and <a href="https://nasstatus.faa.gov/" target="_blank" style="color:#c00;">FAA NAS Status</a>.<br>
    <strong>IROPS = Irregular Operations.</strong>
    All times/dates are local to each airport. "No Weather Risk" means no thunderstorms or weather hazards are forecast for that hour. Does <u>not</u> guarantee VFR or IFR flight conditions.<br>
    Brought to you by Shawn at Budget Airline Apps. The budget was $20.<br>
	<div id="db-status" style="text-align:center; margin:30px 0 10px 0; font-size:1.09rem;">
  <span>DB Status: 
    <span id="db-size" style="color:#c00; font-weight:bold;"></span>
    &nbsp;|&nbsp; 
    <span id="db-days" style="color:#c00; font-weight:bold;"></span>
  </span>
</div>
<script>
fetch('/db_status')
  .then(resp => resp.text())
  .then(txt => {
    // Example: "The DB is 25.4 MB in size and contains 18 days worth of data"
    const sizeMatch = txt.match(/The DB is ([\d\.]+ (?:MB|GB))/i);
    const daysMatch = txt.match(/contains (\d+) days?/i);
    if (sizeMatch) document.getElementById('db-size').textContent = sizeMatch[1] + " in size";
    if (daysMatch) document.getElementById('db-days').textContent = daysMatch[1] + " days of data";
  });
</script>

  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/static/dashboard.js"></script>
</body>
</html>
