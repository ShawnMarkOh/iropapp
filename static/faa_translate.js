window.FAA_LITERAL_TRANSLATIONS = {
  // Major Airports (add your ops hubs as needed)
  "CLT": "Charlotte",
  "DFW": "Dallas/Fort Worth",
  "DCA": "Washington National",
  "PHL": "Philadelphia",
  "DAY": "Dayton",
  // Times and phrases
  "EXC": "except",
  "PPR": "Prior Permission Required",
  "24HR": "24 hours",
  "24 HR": "24 hours",
  "UTC": "Coordinated Universal Time",
  "Z": "Zulu Time (UTC)",
  // Aircraft/Flight
  "A/C": "aircraft",
  "AC": "aircraft",
  "ACFT": "aircraft",
  "ADEP": "airport of departure",
  "ADES": "airport of destination",
  "GA": "general aviation",
  "CFR": "Code of Federal Regulations",
  "SUA": "Special Use Airspace",
  "VFR": "Visual Flight Rules",
  "IFR": "Instrument Flight Rules",
  "TFR": "Temporary Flight Restriction",
  "FLT": "flight",
  "ETA": "estimated time of arrival",
  "ETD": "estimated time of departure",
  "EET": "estimated elapsed time",
  "FPL": "flight plan",
  "FSS": "Flight Service Station",
  "POS": "position",
  "ROUTE": "route",
  "RNAV": "Area Navigation",
  "RVSM": "Reduced Vertical Separation Minimum",
  "G/A": "go-around",
  // Weather
  "WX": "weather",
  "WX DEV": "weather deviation",
  "TS": "thunderstorm",
  "TSTM": "thunderstorm",
  "TSTMS": "thunderstorms",
  "CB": "cumulonimbus",
  "BR": "mist",
  "FG": "fog",
  "HZ": "haze",
  "FZ": "freezing",
  "SN": "snow",
  "RA": "rain",
  "DZ": "drizzle",
  "GR": "hail",
  "GS": "ground stop",
  "SQ": "squall",
  "SH": "shower",
  "VC": "vicinity",
  "SVRWX": "severe weather",
  "LO CIGS": "low ceilings",
  "VSBY": "visibility",
  "WND": "wind",
  "GUST": "gust",
  // Airports and Runways
  "AP": "airport",
  "ARPT": "airport",
  "AD": "aerodrome",
  "RWY": "runway",
  "RY": "runway",
  "CLSD": "closed",
  "OPEN": "open",
  "INTXN": "intersection",
  "TWY": "taxiway",
  "RAMP": "ramp",
  "GA RAMP": "general aviation ramp",
  "BRG": "bearing",
  // Airspace
  "NAS": "National Airspace System",
  "ARTCC": "Air Route Traffic Control Center",
  "TRACON": "Terminal Radar Approach Control",
  "ATCT": "Airport Traffic Control Tower",
  "ASR": "Airport Surveillance Radar",
  "ARSR": "Air Route Surveillance Radar",
  "CTR": "control zone",
  "SFC": "surface",
  "TMA": "Terminal Control Area",
  "UTA": "Upper Control Area",
  "UTAIR": "Upper Airspace",
  "ADIZ": "Air Defense Identification Zone",
  "FIR": "Flight Information Region",
  // Traffic and Flow Management
  "AAR": "Airport Arrival Rate",
  "ADR": "Airspace Design Review",
  "ADVZY": "advisory",
  "ADZY": "advisory",
  "AFP": "Airspace Flow Program",
  "AFP/FCA": "Airspace Flow Program / Flow Constrained Area",
  "FEA": "Flow Evaluation Area",
  "FCA": "Flow Constrained Area",
  "MIT": "miles-in-trail",
  "MINIT": "minutes-in-trail",
  "VOL": "volume",
  "GDP": "Ground Delay Program",
  "GS": "Ground Stop",
  "SWAP": "Severe Weather Avoidance Plan",
  "RRTES": "reroutes",
  "ICR": "Integrated Collaborative Rerouting",
  "SPO": "Strategic Plan of Operation",
  "SPT": "Strategic Planning Team",
  "EDCT": "Expect Departure Clearance Time",
  "CDR": "Coded Departure Routes",
  "OTS": "out of service",
  "RLSD": "released",
  "NOTAM": "Notice to Airmen",
  "CDM": "Collaborative Decision Making",
  "STMP": "Special Traffic Management Program",
  "MULTI-TAXI": "multiple aircraft taxiing simultaneously",
  // Navigation and Equipment
  "ILS": "Instrument Landing System",
  "LOC": "localizer",
  "DME": "distance measuring equipment",
  "NAVAID": "navigational aid",
  "VOR": "VHF Omnidirectional Range",
  "VORTAC": "VOR and TACAN navigation aid",
  "TACAN": "Tactical Air Navigation",
  "GPS": "Global Positioning System",
  "NDB": "non-directional beacon",
  // Operations/Procedures
  "LAHSO": "Land and Hold Short Operations",
  "LAADR": "Low Altitude Arrival/Departure Routing",
  "PILOT": "pilot",
  "TWR": "tower",
  "GND": "ground",
  "TAXI": "taxi",
  "VAPS": "visual approaches",
  "OT": "overtime",
  "RCLS": "runway centerline lights",
  "REIL": "runway end identifier lights",
  "TDZ": "touchdown zone",
  "SMGCS": "Surface Movement Guidance and Control System",
  "RVR": "runway visual range",
  // Flight Rules/Statuses
  "VFR": "Visual Flight Rules",
  "IFR": "Instrument Flight Rules",
  "MVFR": "Marginal VFR",
  "SVFR": "Special VFR",
  "IMC": "Instrument Meteorological Conditions",
  "VMC": "Visual Meteorological Conditions",
  // Airspace Codes (ARTCCs)
  "ZAB": "Albuquerque ARTCC",
  "ZAU": "Chicago ARTCC",
  "ZBW": "Boston ARTCC",
  "ZDC": "Washington ARTCC",
  "ZFW": "Dallas-Fort Worth ARTCC",
  "ZHU": "Houston ARTCC",
  "ZID": "Indianapolis ARTCC",
  "ZJX": "Jacksonville ARTCC",
  "ZKC": "Kansas City ARTCC",
  "ZLA": "Los Angeles ARTCC",
  "ZLC": "Salt Lake City ARTCC",
  "ZMA": "Miami ARTCC",
  "ZME": "Memphis ARTCC",
  "ZMP": "Minneapolis ARTCC",
  "ZNY": "New York ARTCC",
  "ZOA": "Oakland ARTCC",
  "ZOB": "Cleveland ARTCC",
  "ZSE": "Seattle ARTCC",
  "ZTL": "Atlanta ARTCC",
  // General
  "NM": "nautical mile",
  "FT": "feet",
  "M": "meters",
  "KT": "knot",
  "KTS": "knots",
  "MPH": "miles per hour",
  "SEC": "seconds",
  "MIN": "minutes",
  "HR": "hour",
  // Time descriptors
  "AM": "AM",
  "PM": "PM",
  "MIDNIGHT": "midnight",
  "NOON": "noon",
  "DAWN": "dawn",
  "DUSK": "dusk",
  // Additional abbreviations
  "ADM": "aerodrome",
  "ATM": "air traffic management",
  "CAA": "Civil Aviation Authority",
  "CAS": "calibrated airspeed",
  "DCT": "direct",
  "DEP": "departure",
  "ARR": "arrival",
  "EST": "estimate",
  "LDG": "landing",
  "TKOF": "takeoff",
  "POSN": "position",
  "REQ": "request",
  "RTE": "route",
  "XING": "crossing",
  "XWIND": "crosswind",
  // Weather, cont.
  "OVC": "overcast",
  "BKN": "broken",
  "SCT": "scattered",
  "FEW": "few",
  "CLR": "clear",
  "SKC": "sky clear",
  "VIS": "visibility",
  "SM": "statute miles",
  "LTG": "lightning",
  "OCNL": "occasional",
  "FRQ": "frequent",
  "EMBD": "embedded",
  "CONS": "continuous",
  "TEMPO": "temporary",
  "BECMG": "becoming",
  "NSW": "no significant weather",
  // Military
  "ANG": "Air National Guard",
  "USA": "United States Army",
  "USAF": "United States Air Force",
  "USN": "United States Navy",
  "USMC": "United States Marine Corps",
  // FAA/ATC Codes
  "FAA": "Federal Aviation Administration",
  "ATC": "Air Traffic Control",
  "ATIS": "Automatic Terminal Information Service",
  "AWOS": "Automated Weather Observing System",
  "ASOS": "Automated Surface Observing System",
  "FBO": "Fixed Base Operator"
};

function translateFAAString(str) {
  if (!str) return '';
  let result = ' ' + str + ' ';
  const entries = Object.entries(window.FAA_LITERAL_TRANSLATIONS)
    .sort((a, b) => b[0].length - a[0].length);
  for (const [abbr, translation] of entries) {
    const re = new RegExp(`\\b${abbr}\\b`, 'gi');
    result = result.replace(re, translation);
  }
  return result.replace(/\s+/g, ' ').trim();
}

function highlightFAAAbbreviations(str) {
  if (!str) return '';
  
  // Escape HTML special characters from the input string to prevent XSS
  const tempDiv = document.createElement('div');
  tempDiv.textContent = str;
  let result = tempDiv.innerHTML;

  const entries = Object.entries(window.FAA_LITERAL_TRANSLATIONS)
    .sort((a, b) => b[0].length - a[0].length);
  
  for (const [abbr, translation] of entries) {
    const escapedAbbr = abbr.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
    const re = new RegExp(`\\b(${escapedAbbr})\\b`, 'gi');
    
    result = result.replace(re, (match) => `<span class="faa-term" title="${translation}">${match}</span>`);
  }
  return result;
}
